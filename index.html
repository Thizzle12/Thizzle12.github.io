<!DOCTYPE html>
<html lang="en" style="font-family: sans-serif; font-weight:bold; font-size:24px;">
	<head>
		<meta charset="utf-8">
		<title>D3: Setting paragraphs' style conditionally, based on data</title>
		<script type="text/javascript" src="../d3.js"></script>
		<link rel="stylesheet" type="text/css" href="ExFruit.css">
	</head>
	<body>
		<h2>NYC Green Markets - Unique Produce Types</h2>
		<p id="index0" class="selection">Fresh Fruit</p>
		<p id="index1" class="selection">Storage Fruit</p>
		<p id="index2" class="selection">Fresh Vegetables</p>
		<p id="index3" class="selection">Storage Vegetables</p>

		<script type="text/javascript">
			var dataset, xScale, yScale;
			var w = 1000;
			var h = 300;
			var xPadding = 60;
			var yPadding = 40;
			var svg, xAxis, yAxis;
			var origData;
			var ticks = d3.range([12]);


			d3.csv("data1.csv", function(data){
				origData = data;
				dataset = data.slice(0,12);
				xScale = d3.scaleBand()
										.domain(d3.range([12]))
										.rangeRound([0,w-xPadding])
										.paddingInner(0.05);

				yScale = d3.scaleLinear()
										.domain([0, d3.max(dataset, function(d){
											return parseFloat(d.Count);
										})])
										.range([h-yPadding, 0]);

				xAxis = d3.axisBottom()
									.scale(xScale)
									.tickValues(ticks)
									.tickFormat(function(d,i){
										return dataset[i].Month
									});

				yAxis = d3.axisLeft()
									.scale(yScale)
									.ticks(10);

				makeVis();
			});

			function makeVis(){



				svg = d3.select("body")
									.append("svg")
									.attr("width", w)
									.attr("height", h);

				svg.selectAll("rect")
					.data(dataset.slice(0,12))
					.enter()
					.append("rect")
					.attr("x", function(d, i){
						return xScale(i)+xPadding;
					})
					.attr("width", xScale.bandwidth())
					.attr("y", function(d){
						return (yScale(d.Count))+10;
					})
					.attr("height", function(d) {
						return h-yScale(d.Count)-yPadding;
					})
					.attr("fill", function(d){
							return "rgb(0,0,255)"
					})

					svg.selectAll("text")
						.data(dataset.slice(0,12))
						.enter()
						.append("text")
						.text(function(d){
								return d.Count;
						})
						.attr("x", function(d, i){
							return xScale(i)+xScale.bandwidth()/2 + xPadding;
						})
						.attr("y", function(d, i){
							if(d.Count > 1){
								return yScale(d.Count) + 30;
							}
						})
						.attr("font-size", "10px")
						.attr("fill", "white")
						.attr("font-family", "sans-serif")
						.attr("text-anchor", "middle");


					svg.append("g")
							.attr("class", "x axis")
							.attr("transform", "translate( " + xPadding + ", " + (h-yPadding+10) + ")")
							.call(xAxis);

					svg.append("g")
							.attr("class", "y axis")
							.attr("transform", "translate(" + xPadding + " ,10)")
							.call(yAxis);

					svg.append("text")
					    .attr("class", "y label")
					    .attr("text-anchor", "end")
					    .attr("y", 25)
							.attr("x", -25)
					    .attr("dy", "5px")
							.attr("font-size", "15px")
					    .attr("transform", "rotate(-90)")
					    .text("# of Unique Kinds of Produce");
				}


				d3.select("#index0")
					.on("click", function(){
						dataset = origData.slice(0,12);
						yScale.domain([0, d3.max(dataset,function(d){
							return parseFloat(d.Count);
						})])
						svg.selectAll("rect")
								.data(dataset)
								.transition()
								.duration(700)
								.attr("y", function(d){
									return (yScale(d.Count))+10;
								})
								.attr("height", function(d) {
									return h-yScale(d.Count)-yPadding;
								})
								.attr("fill", function(){
										return "rgb(0,0,255)"
								});

						svg.selectAll("text")
								.data(dataset)
								.transition()
								.duration(700)
								.text(function(d){
									return d.Count;
								})
								.attr("x", function(d, i){
									return xScale(i)+xScale.bandwidth()/2 + xPadding;
								})
								.attr("y", function(d, i){
									if(d.Count > 1){
										return yScale(d.Count) + 30;
									}
								});

						svg.select(".x.axis")
								.transition()
								.duration(700)
								.call(xAxis)
						svg.select(".y.axis")
								.transition()
								.duration(700)
								.call(yAxis)
					})

					d3.select("#index1")
						.on("click", function(){
							dataset = origData.slice(12,24);
							yScale.domain([0, d3.max(dataset,function(d){
								return parseFloat(d.Count);
							})])
							svg.selectAll("rect")
									.data(dataset)
									.transition()
									.duration(700)
									.attr("y", function(d){
										return (yScale(d.Count))+10;
									})
									.attr("height", function(d) {
										return h-yScale(d.Count)-yPadding;
									})
									.attr("fill", function(){
											return "rgb(0,255,0)"
									});

							svg.selectAll("text")
									.data(dataset)
									.transition()
									.duration(700)
									.text(function(d){
										return d.Count;
									})
									.attr("x", function(d, i){
										return xScale(i)+xScale.bandwidth()/2 + xPadding;
									})
									.attr("y", function(d, i){
										if(d.Count > 1){
											return yScale(d.Count) + 30;
										}
									})


							svg.select(".x.axis")
									.transition()
									.duration(700)
									.call(xAxis)
							svg.select(".y.axis")
									.transition()
									.duration(700)
									.call(yAxis)
						})

						d3.select("#index2")
							.on("click", function(){
								dataset = origData.slice(24,36);

								// console.log(d3.max(dataset,function(d){
								// 	return parseFloat(d.Count);
								// }))

								yScale.domain([0, d3.max(dataset,function(d){

									return parseFloat(d.Count);
								})])
								svg.selectAll("rect")
										.data(dataset)
										.transition()
										.duration(700)
										.attr("y", function(d){
											return (yScale(d.Count))+10;
										})
										.attr("height", function(d) {
											return h-yScale(d.Count)-yPadding;
										})
										.attr("fill", function(){
												return "rgb(255,0,0)"
										});

								svg.selectAll("text")
										.data(dataset)
										.transition()
										.duration(700)
										.text(function(d){
											return d.Count;
										})
										.attr("x", function(d, i){
											return xScale(i)+xScale.bandwidth()/2 + xPadding;
										})
										.attr("y", function(d, i){
											if(d.Count > 1){
												return yScale(d.Count) + 30;
											}
										})

								svg.select(".x.axis")
										.transition()
										.duration(700)
										.call(xAxis)
								svg.select(".y.axis")
										.transition()
										.duration(700)
										.call(yAxis)
							})

							d3.select("#index3")
								.on("click", function(){
									dataset = origData.slice(36,origData.length);
									yScale.domain([0, d3.max(dataset,function(d){
										return parseFloat(d.Count);
									})])
									svg.selectAll("rect")
											.data(dataset)
											.transition()
											.duration(700)
											.attr("y", function(d){
												return (yScale(d.Count))+10;
											})
											.attr("height", function(d) {
												return h-yScale(d.Count)-yPadding;
											})
											.attr("fill", function(){
													return "rgb(0,0,0)"
											});

									svg.selectAll("text")
											.data(dataset)
											.transition()
											.duration(700)
											.text(function(d){
												return d.Count;
											})
											.attr("x", function(d, i){
												return xScale(i)+xScale.bandwidth()/2 + xPadding;
											})
											.attr("y", function(d, i){
												if(d.Count > 1){
													return yScale(d.Count) + 30;
												}
											})

									svg.select(".x.axis")
											.transition()
											.duration(700)
											.call(xAxis)
									svg.select(".y.axis")
											.transition()
											.duration(700)
											.call(yAxis)
								})

		</script>




	</body>
</html>
